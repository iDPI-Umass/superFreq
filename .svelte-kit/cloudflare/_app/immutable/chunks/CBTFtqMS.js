import"./Bg9kRutz.js";import{al as ee,K as te,I as P,x as ae,aJ as ne,U as R,ad as F,T as J,af as y,a0 as re,aE as G,aD as O,aK as z,h as le,O as L,G as D,P as T,aL as se,y as ie,p as oe,f as K,b as ce,g as p,e as ue,t as I}from"./CIC73nbL.js";import{d as B,a as v,t as M}from"./D1sabymj.js";import{i as fe}from"./w9zPIjBD.js";import{s as h,a as U,c as x}from"./pfHeeLMb.js";import{p as me}from"./D8QYH9wd.js";import{m as _e,c as de,i as X}from"./DOrtXGrH.js";import{w}from"./BShju2DL.js";const S=0,N=1,j=2;function ge(a,e,t,r,n){P&&ae();var s=a,u=ee(),o=le,l=R,f,c,i,m=(u?J:y)(void 0),A=(u?J:y)(void 0),d=!1;function g(_,b){d=!0,b&&(G(E),O(E),z(o));try{_===S&&t&&(f?L(f):f=D(()=>t(s))),_===N&&r&&(c?L(c):c=D(()=>r(s,m))),_===j&&n&&(i?L(i):i=D(()=>n(s,A))),_!==S&&f&&T(f,()=>f=null),_!==N&&c&&T(c,()=>c=null),_!==j&&i&&T(i,()=>i=null)}finally{b&&(z(null),O(null),G(null),se())}}var E=te(()=>{if(l!==(l=e())){if(ne(l)){var _=l;d=!1,_.then(b=>{_===l&&(F(m,b),g(N,!0))},b=>{if(_===l&&(F(A,b),g(j,!0),!n))throw A.v}),P?t&&(f=D(()=>t(s))):re(()=>{d||g(S,!0)})}else F(m,l),g(N,!1);return()=>l=R}});P&&(s=ie)}const ke="https://rhibvhnquyqpnvchwuvm.supabase.co",Ee="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJoaWJ2aG5xdXlxcG52Y2h3dXZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDQ5MjgyMTQsImV4cCI6MjAyMDUwNDIxNH0.7L3C5FMKXafj26LbxuCWyPTPtDNe4G4faN47oxzQSZs",be="a50a3dc9aa18fc664a2711e70ef21cec",pe=be,Re=async function(a,e,t){if(!a)return{mbData:null,searchComplete:!1};const r=de[e];let n="https://musicbrainz.org/ws/2/";n=n.concat(r);const s=new URL(n);s.searchParams.set("fmt","json"),s.searchParams.set("query",`${a}`),s.searchParams.set("limit",t),e=="recordings"&&s.searchParams.set("inc","releases+release-groups+artist-rels");const o=await(await fetch(s)).json(),l=r.concat("s");return{mbData:o[l],searchComplete:!0}},Z=async function(a,e,t){let r=null,n=null;const s=`https://musicbrainz.org/ws/2/release?release-group=${e}&inc=labels&fmt=json`;if(a=="release_groups"||a=="recordings"){let o=await(await fetch(s)).json();if(o=o.releases,o&&o.length>0){for(const l of o)if(t==l.date)return l["label-info"].length>0&&(r=l["label-info"][0].label.name,n=l["label-info"][0].label.id),{name:r,mbid:n}}}return{name:r,mbid:n}},Je=function(a){return _e[a]},Y=function(a,e){let t=null;return a=="artists"?t=e.id??null:(a=="release_groups"||a=="recordings")&&(t=e["artist-credit"][0].artist.id??null),t},Q=function(a,e){let t=null;return a=="artists"?t=e.name??null:(a=="release_groups"||a=="recordings")&&(t=e["artist-credit"][0].artist.name??null),t},ye=function(a,e){let t=null;return a=="artists"&&(t=e.area?e.area.name:null),t},Ge=function(a,e){let t={mbid:null,release_date:null,artist_name:null,release_group_name:null};return a=="release_groups"?t={mbid:e.id,release_date:e["first-release-date"],artist_name:e["artist-credit"][0].artist.name,release_group_name:e.title}:a=="recordings"&&(t={mbid:e.releases[0]["release-group"].id,release_date:null,artist_name:e["artist-credit"][0].artist.name,release_group_name:e.releases[0]["release-group"].title}),t},q=function(a,e){let t=null;return a=="release_groups"?t=e.id??null:a=="recordings"&&(t=e.releases[0]["release-group"].id??null),t},H=function(a,e){let t=null;return a=="release_groups"?t=e.title??null:a=="recordings"&&(t=e.releases?e.releases[0]["release-group"].title:null),t},V=function(a,e){let t=null;return a=="recordings"&&(t=e.id??null),t},W=function(a,e){let t=null;return a=="recordings"&&(t=e.title??null),t},C=function(a,e){let t=null;return a=="recordings"&&(t=e.releations&&e.relations[0].artist.type=="remixer"?e.relations[0].artist.id:null),t},$=function(a,e){let t="";return a=="artists"?t=e["life-span"]?e["life-span"].begin:"":a=="release_groups"&&(t=e["first-release-date"]??""),t};function ve(a){return a.size=="mega"}const k=async function(a){try{const e=`https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=${pe}&artist=${a.artist_name}&album=${a.release_group_name}&format=json`;return(await(await fetch(e)).json()).album.image.find(ve)["#text"]}catch{return null}},Oe=async function(a){const e=`https://coverartarchive.org/release-group/${a.mbid}/front`;try{const r=(await fetch(e,{signal:AbortSignal.timeout(3e3)})).url,n=await k(a);return{coverArtArchiveUrl:r,lastFmCoverArtUrl:n,success:!0}}catch{const r=await k(a);return r?{coverArtArchiveUrl:null,lastFmCoverArtUrl:r,success:!0}:{coverArtArchiveUrl:null,lastFmCoverArtUrl:null,success:!1}}},Ae=function(a,e,t,r){if(t.length<1)return{isDuplicate:!1,duplicateItem:null};const n=e.find(l=>l[r]==a),s=e.find(l=>l.user_added_metadata_id==a),u=!!(n||s);return{isDuplicate:u,duplicateItem:u?n??s:null}},he=function(a,e,t){if(e.length<=1)return!1;const r=a.id;return!!e.find(s=>s[t]==r)},we=function(a,e){const t=parseInt(a);return e.length>=t},ze=async function(a,e,t,r,n,s){const{isDuplicate:u}=Ae(a.id,e,t,s),o=he(a,t,s),l=we(r,e),f=a.id;if(u)return alert("That item is already in this collection."),{addedItems:e,deletedItems:t,newItemAdded:!1};let c=null;if(o){const d=t.find(g=>g[s]==f);c=d==null?void 0:d.original_id,t=t.filter(g=>g!=d),alert("That item was previously deleted from this collection, but will now be added back in.")}if(l)return alert(`Only ${r} items are allowed in this collection. Please delete an item before you add something new.`),{addedItems:e,deletedItems:t,newItemAdded:!1};const i=q(n,a),m=$(n,a),A=await Z(n,i,m);return e=[...e,{original_id:c??null,item_position:e.length,artist_mbid:Y(n,a),artist_name:Q(n,a),release_group_mbid:i,release_group_name:H(n,a),recording_mbid:V(n,a),recording_name:W(n,a),remixer_mbid:C(n,a)??null,release_date:m,img_url:null,last_fm_img_url:null,label:A.name,notes:null,item_type:X[n],id:e.length}],{addedItems:e,deletedItems:t,newItemAdded:!0}},Ke=async function(a,e,t){const r=q(t,a),n=$(t,a),s=await Z(t,r,n);return e={artist_mbid:Y(t,a),artist_name:Q(t,a),release_group_mbid:r,release_group_name:H(t,a),recording_mbid:V(t,a),recording_name:W(t,a),remixer_mbid:C(t,a),release_date:n,img_url:null,last_fm_img_url:null,label:s.name,notes:null,item_type:X[t]},{addedItems:e}};var De=M("<img>"),Ie=M('<img alt="not found">'),Ue=M('<img alt="loading">'),xe=M('<img alt="not found">');function Be(a,e){oe(e,!0);const t=ue(()=>e.item!=null?e.item:{img_url:e.imgUrl??null,last_fm_img_url:null,artist_name:e.artistName,release_group_name:e.releaseGroupName});me(w);var r=B(),n=K(r);{var s=o=>{var l=B(),f=K(l);ge(f,()=>k(p(t)),c=>{var i=Ue();h(i,"src",w),I(()=>U(i,1,x(e.imgClass),"svelte-711cl0")),v(c,i)},(c,i)=>{var m=De();I(()=>{h(m,"src",p(i)?p(i):w),h(m,"alt",p(i)?e.altText:"not found"),U(m,1,x(e.imgClass),"svelte-711cl0")}),v(c,m)},c=>{var i=Ie();h(i,"src",w),I(()=>U(i,1,x(e.imgClass),"svelte-711cl0")),v(c,i)}),v(o,l)},u=o=>{var l=xe();h(l,"src",w),I(()=>U(l,1,x(e.imgClass),"svelte-711cl0")),v(o,l)};fe(n,o=>{p(t).artist_name&&p(t).artist_name!=null?o(s):o(u,!1)})}v(a,r),ce()}export{Be as C,Ee as P,ge as a,Re as b,Q as c,ye as d,Ke as e,q as f,Oe as g,ze as h,$ as i,Ge as j,W as k,ke as l,Je as m,H as r};
