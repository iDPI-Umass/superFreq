var Xt=Object.defineProperty;var Rt=e=>{throw TypeError(e)};var Yt=(e,t,r)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var rt=(e,t,r)=>Yt(e,typeof t!="symbol"?t+"":t,r),It=(e,t,r)=>t.has(e)||Rt("Cannot "+r);var m=(e,t,r)=>(It(e,t,"read from private field"),r?r.call(e):t.get(e)),A=(e,t,r)=>t.has(e)?Rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Mt=(e,t,r,s)=>(It(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);import"../chunks/CWj6FrbW.js";import{a as at,e as _,g as a,ai as Zt,s as st,p as ut,f as D,b as vt,c as l,a1 as yt,r as c,t as V,a4 as $t,d as f}from"../chunks/DKxP8oaF.js";import{d as X,a as b,t as N}from"../chunks/DCT9fmD9.js";import{i as W}from"../chunks/XPA7DDzn.js";import{e as te,i as ee}from"../chunks/Cpe_MceB.js";import{d as Nt,r as ht,s as nt,b as gt}from"../chunks/DubPOQGL.js";import{S as re}from"../chunks/CdBRc-Mf.js";import{L as ae,a as se,U as Tt,N as ie}from"../chunks/D1y81lpy.js";import{s as At}from"../chunks/d8TzcK2t.js";import{c as Ot}from"../chunks/DqG9MKSW.js";import{p as O,r as kt}from"../chunks/C6N4_jbr.js";import{C as ne}from"../chunks/mnVZ5n0Q.js";import"../chunks/C15yfjWY.js";import{I as oe}from"../chunks/BeMa8PAS.js";import{d as de}from"../chunks/-Ocsa0V4.js";import{s as ot}from"../chunks/BpB5Zjcp.js";import{C as le,u as Dt,w as ce,y as pe,p as Ft,g as Lt,j as Ut,n as ue,d as q,m as Et,z as ve}from"../chunks/B6PuFPFt.js";import{p as it}from"../chunks/DIWzF7VF.js";const me="data-collapsible-root",fe="data-collapsible-content";var Y,dt;class _e{constructor(t){rt(this,"opts");A(this,Y,at(null));A(this,dt,_(()=>({id:this.opts.id.current,"data-state":Lt(this.opts.open.current),"data-disabled":Ft(this.opts.disabled.current),[me]:""})));this.opts=t,this.toggleOpen=this.toggleOpen.bind(this),Dt(t)}get contentNode(){return a(m(this,Y))}set contentNode(t){st(m(this,Y),it(t))}toggleOpen(){this.opts.open.current=!this.opts.open.current}get props(){return a(m(this,dt))}}Y=new WeakMap,dt=new WeakMap;var j,G,H,J,lt,ct,pt;class he{constructor(t,r){rt(this,"opts");rt(this,"root");A(this,j);A(this,G,at(!1));A(this,H,at(0));A(this,J,at(0));A(this,lt,_(()=>this.opts.forceMount.current||this.root.opts.open.current));A(this,ct,_(()=>({open:this.root.opts.open.current})));A(this,pt,_(()=>({id:this.opts.id.current,style:{"--bits-collapsible-content-height":a(m(this,J))?`${a(m(this,J))}px`:void 0,"--bits-collapsible-content-width":a(m(this,H))?`${a(m(this,H))}px`:void 0},"data-state":Lt(this.root.opts.open.current),"data-disabled":Ft(this.root.opts.disabled.current),[fe]:""})));this.opts=t,this.root=r,m(this,G).v=it(r.opts.open.current),Dt({...t,deps:()=>this.present,onRefChange:s=>{this.root.contentNode=s}}),Zt(()=>{const s=requestAnimationFrame(()=>{st(m(this,G),!1)});return()=>{cancelAnimationFrame(s)}}),ce([()=>this.opts.ref.current,()=>this.present],([s])=>{s&&pe(()=>{if(!this.opts.ref.current)return;Mt(this,j,m(this,j)||{transitionDuration:s.style.transitionDuration,animationName:s.style.animationName}),s.style.transitionDuration="0s",s.style.animationName="none";const h=s.getBoundingClientRect();if(st(m(this,J),it(h.height)),st(m(this,H),it(h.width)),!a(m(this,G))){const{animationName:p,transitionDuration:S}=m(this,j);s.style.transitionDuration=S,s.style.animationName=p}})})}get present(){return a(m(this,lt))}get snippetProps(){return a(m(this,ct))}get props(){return a(m(this,pt))}}j=new WeakMap,G=new WeakMap,H=new WeakMap,J=new WeakMap,lt=new WeakMap,ct=new WeakMap,pt=new WeakMap;const qt=new le("Collapsible.Root");function ge(e){return qt.set(new _e(e))}function ye(e){return new he(e,qt.get())}var be=N("<div><!></div>");function Se(e,t){ut(t,!0);let r=O(t,"id",19,Ut),s=O(t,"ref",15,null),h=O(t,"open",15,!1),p=O(t,"disabled",3,!1),S=O(t,"onOpenChange",3,ue),C=kt(t,["$$slots","$$events","$$legacy","children","child","id","ref","open","disabled","onOpenChange"]);const k=ge({open:q.with(()=>h(),o=>{h(o),S()(o)}),disabled:q.with(()=>p()),id:q.with(()=>r()),ref:q.with(()=>s(),o=>s(o))}),u=_(()=>Et(C,k.props));var g=X(),P=D(g);{var x=o=>{var v=X(),d=D(v);ot(d,()=>t.child,()=>({props:a(u)})),b(o,v)},R=o=>{var v=be();let d;var i=l(v);ot(i,()=>t.children??yt),c(v),V(()=>d=Nt(v,d,{...a(u)})),b(o,v)};W(P,o=>{t.child?o(x):o(R,!1)})}b(e,g),vt()}var we=N("<div><!></div>");function Ce(e,t){ut(t,!0);let r=O(t,"ref",15,null),s=O(t,"forceMount",3,!1),h=O(t,"id",19,Ut),p=kt(t,["$$slots","$$events","$$legacy","child","ref","forceMount","children","id"]);const S=ye({id:q.with(()=>h()),forceMount:q.with(()=>s()),ref:q.with(()=>r(),C=>r(C))});ve(e,{forceMount:!0,get present(){return S.present},get id(){return h()},presence:(k,u)=>{let g=()=>u==null?void 0:u().present;var P=X();const x=_(()=>Et(p,S.props,{hidden:s()?void 0:!g().current}));var R=D(P);{var o=d=>{var i=X(),M=D(i),U=$t(()=>({...S.snippetProps,props:a(x)}));ot(M,()=>t.child,()=>a(U)),b(d,i)},v=d=>{var i=we();let M;var U=l(i);ot(U,()=>t.children??yt),c(i),V(()=>M=Nt(i,M,{...a(x)})),b(d,i)};W(R,d=>{t.child?d(o):d(v,!1)})}b(k,P)},$$slots:{presence:!0}}),vt()}function xe(e){const t=e-1;return t*t*t+1}function Pe(e,{delay:t=0,duration:r=400,easing:s=xe,axis:h="y"}={}){const p=getComputedStyle(e),S=+p.opacity,C=h==="y"?"height":"width",k=parseFloat(p[C]),u=h==="y"?["top","bottom"]:["left","right"],g=u.map(i=>`${i[0].toUpperCase()}${i.slice(1)}`),P=parseFloat(p[`padding${g[0]}`]),x=parseFloat(p[`padding${g[1]}`]),R=parseFloat(p[`margin${g[0]}`]),o=parseFloat(p[`margin${g[1]}`]),v=parseFloat(p[`border${g[0]}Width`]),d=parseFloat(p[`border${g[1]}Width`]);return{delay:t,duration:r,easing:s,css:i=>`overflow: hidden;opacity: ${Math.min(i*20,1)*S};${C}: ${i*k}px;padding-${u[0]}: ${i*P}px;padding-${u[1]}: ${i*x}px;margin-${u[0]}: ${i*R}px;margin-${u[1]}: ${i*o}px;border-${u[0]}-width: ${i*v}px;border-${u[1]}-width: ${i*d}px;min-${C}: 0`}}var Re=N('<div class="reply-editor"><form name="submitReply" id="submitReply" class="reply" method="post" action="?/submitReply"><textarea rows="4" cols="1" id="reply-text" name="reply-text" spellcheck="true" placeholder="Reply..." required></textarea> <button class="standard svelte-zeyi1k" formaction="?/submitReply">submit</button></form></div>');function zt(e){var t=Re();b(e,t)}var Ie=N('<span class="status-badge">edited</span>'),Me=N('<input type="hidden" name="post-reply-id" id="post-reply-id" form="delete"> <input type="hidden" name="post-reply-id" id="post-reply-id" form="flagPost"> <div class="comment-panel"><div class="comment"><div class="comment-metadata"><div class="row-group-user-data"><!> <div class="row-group-column"><a><span class="comment-display-name"> </span></a> <a><span class="date" aria-label="permalink"> <!></span></a></div></div> <div class="row-group"><!></div></div> <div class="comment-text"><!></div> <div class="comment-reaction-row"><div class="row-group"><div class="row-group-icons"><!></div></div> <div class="row-group-icon-description"><!></div></div></div> <!></div>',1);function Te(e,t){var wt,Ct,xt;ut(t,!0);let r=O(t,"editState",15,!1),s=O(t,"userActionSuccess",11,null),h;const p=_(()=>!!t.reply.reaction_user_ids.includes(t.sessionUserId)),S=(wt=t.parentPost)==null?void 0:wt.created_at.toISOString(),C=Date.parse(S).toString(),k=(Ct=t.reply)==null?void 0:Ct.created_at.toISOString(),u=Date.parse(k).toString(),g=`/posts/${t.parentPost.username}/now-playing/${C}#${(xt=t.reply.username)==null?void 0:xt.concat(u)}`;var P=Me(),x=D(P);ht(x);var R=f(x,2);ht(R);var o=f(R,2),v=l(o),d=l(v),i=l(d),M=l(i);const U=_(()=>`${t.reply.display_name}'s avatar`);ne(M,{get item(){return t.reply},get altText(){return a(U)},imgClass:"avatar"});var Z=f(M,2),z=l(Z),K=l(z),n=l(K,!0);c(K),c(z);var y=f(z,2);nt(y,"href",g);var T=l(y),I=l(T),F=f(I);ae(F,{size:"15",color:"var(--freq-color-text-muted)"}),c(T),c(y),c(Z),c(i);var $=f(i,2),B=l($);{var Q=w=>{var E=Ie();b(w,E)};W(B,w=>{t.reply.status==="edited"&&w(Q)})}c($),c(d);var L=f(d,2),mt=l(L);oe(mt,{get text(){return t.reply.text}}),c(L);var tt=f(L,2),ft=l(tt),bt=l(ft),Bt=l(bt);se(Bt,{get postId(){return t.reply.id},get reactionActive(){return a(p)},get reactionCount(){return t.reply.reaction_count}}),c(bt),c(ft);var St=f(ft,2),Wt=l(St);{var jt=w=>{Tt(w,{mode:"sessionUserPostMenu",get postId(){return t.reply.id},get success(){return s()},get editState(){return r()},set editState(E){r(E)}})},Gt=(w,E)=>{{var _t=et=>{Tt(et,{mode:"postMenu",get success(){return s()}})};W(w,et=>{t.reply.user_id!=t.sessionUserId&&et(_t)},E)}};W(Wt,w=>{t.reply.user_id==t.sessionUserId?w(jt):w(Gt,!1)})}c(St),c(tt),c(v);var Ht=f(v,2);Ot(Ht,()=>Se,(w,E)=>{E(w,{get open(){return h},children:(_t,et)=>{var Pt=X(),Jt=D(Pt);Ot(Jt,()=>Ce,(Kt,Qt)=>{Qt(Kt,{transition:Pe,children:(Vt,Fe)=>{zt(Vt)},$$slots:{default:!0}})}),b(_t,Pt)},$$slots:{default:!0}})}),c(o),V(w=>{gt(x,t.reply.id),gt(R,t.reply.id),nt(z,"href",`/user/${t.reply.username??""}`),At(n,t.reply.display_name),At(I,`${w??""} `)},[()=>de(t.reply.created_at)]),b(e,P),vt()}var Ae=N('<input type="hidden" name="post-id" id="post-id"> <input type="hidden" name="reaction-type" id="reaction-type" form="submitReaction" value="like">',1),Oe=N("<div><!></div>"),Ne=N("<!> <!> <!>",1),ke=N('<div class="panel"><p>This post has been deleted.</p></div>'),De=N('<!> <div class="post-panel"><!> <!> <!> <!> <!></div>',1);function er(e,t){var K;ut(t,!0);const r=(n,y=yt)=>{var T=Ae(),I=D(T);ht(I),f(I,2),V(()=>{var F;nt(I,"form",y()),gt(I,(F=a(s))==null?void 0:F.id)}),b(n,T)};let s=_(()=>t.data.post),h=_(()=>t.data.replies),p=_(()=>t.data.collections),S=(K=t.data)==null?void 0:K.sessionUserId,C=_(()=>{var n;return(n=t.form)==null?void 0:n.success}),k=_(()=>{var n;return((n=t.form)==null?void 0:n.showCollectionsModal)??!1}),u=_(()=>{var n;return((n=t.form)==null?void 0:n.updateSuccess)??!1});function g(n,y){const T=y.toISOString(),I=Date.parse(T).toString();return n==null?void 0:n.concat(I)}var P=De(),x=D(P);const R=_(()=>{var n;return(n=a(s))==null?void 0:n.display_name});re(x,{get title(){return`${a(R)??""}'s Now Playing post`}});var o=f(x,2),v=l(o);r(v,()=>"submitReply");var d=f(v,2);r(d,()=>"submitReaction");var i=f(d,2);r(i,()=>"delete");var M=f(i,2);r(M,()=>"flagPost");var U=f(M,2);{var Z=n=>{var y=Ne(),T=D(y);const I=_(()=>{var B;return(B=t.form)==null?void 0:B.editState});ie(T,{sessionUserId:S,get post(){return a(s)},get editState(){return a(I)},get userActionSuccess(){return a(C)},get collections(){return a(p)},get showCollectionsModal(){return a(k)},get showSaveSucessModal(){return a(u)}});var F=f(T,2);zt(F);var $=f(F,2);te($,17,()=>a(h),ee,(B,Q)=>{var L=Oe(),mt=l(L);Te(mt,{get reply(){return a(Q)},get parentPost(){return a(s)},sessionUserId:S,get userActionSuccess(){return a(C)}}),c(L),V(tt=>nt(L,"id",tt),[()=>g(a(Q).username,a(Q).created_at)]),b(B,L)}),b(n,y)},z=n=>{var y=ke();b(n,y)};W(U,n=>{var y;((y=a(s))==null?void 0:y.status)!="deleted"?n(Z):n(z,!1)})}c(o),b(e,P),vt()}export{er as component};
