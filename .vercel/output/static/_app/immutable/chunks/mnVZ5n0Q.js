import"./CWj6FrbW.js";import{J as ne,G as T,w as se,aG as ie,U as H,a7 as S,R as O,$ as oe,ay as X,ax as y,aH as z,h as ue,N as j,F as R,O as k,aE as ce,x as me,p as fe,f as B,b as _e,g as v,e as q,t as I}from"./DKxP8oaF.js";import{d as Z,a as h,t as F}from"./DCT9fmD9.js";import{i as K}from"./XPA7DDzn.js";import{s as w,a as N,c as x}from"./DubPOQGL.js";import{p as M}from"./C6N4_jbr.js";import{m as de,c as ge,i as Y}from"./-Ocsa0V4.js";const J=0,E=1,G=2;function ve(a,t,e,s,r){T&&se();var l=a,u=ue,n=H,i,m,g,p=O(void 0),b=O(void 0),f=!1;function o(_,c){f=!0,c&&(X(A),y(A),z(u));try{_===J&&e&&(i?j(i):i=R(()=>e(l))),_===E&&s&&(m?j(m):m=R(()=>s(l,p))),_===G&&r&&(g?j(g):g=R(()=>r(l,b))),_!==J&&i&&k(i,()=>i=null),_!==E&&m&&k(m,()=>m=null),_!==G&&g&&k(g,()=>g=null)}finally{c&&(z(null),y(null),X(null),ce())}}var A=ne(()=>{if(n!==(n=t())){if(ie(n)){var _=n;f=!1,_.then(c=>{_===n&&(S(p,c),o(E,!0))},c=>{if(_===n&&(S(b,c),o(G,!0),!r))throw b.v}),T?e&&(i=R(()=>e(l))):oe(()=>{f||o(J,!0)})}else S(p,n),o(E,!1);return()=>n=H}});T&&(l=me)}const Je="https://rhibvhnquyqpnvchwuvm.supabase.co",Ge="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJoaWJ2aG5xdXlxcG52Y2h3dXZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDQ5MjgyMTQsImV4cCI6MjAyMDUwNDIxNH0.7L3C5FMKXafj26LbxuCWyPTPtDNe4G4faN47oxzQSZs",pe="a50a3dc9aa18fc664a2711e70ef21cec",P=""+new URL("../assets/freq-wave.BxfgvkIv.svg",import.meta.url).href,be=pe,He=async function(a,t,e){if(!a)return{mbData:null,searchComplete:!1};const s=ge[t];let r="https://musicbrainz.org/ws/2/";r=r.concat(s);const l=new URL(r);l.searchParams.set("fmt","json"),l.searchParams.set("query",`${a}`),l.searchParams.set("limit",e),t=="recordings"&&l.searchParams.set("inc","releases+release-groups+artist-rels");const n=await(await fetch(l)).json(),i=s.concat("s");return{mbData:n[i],searchComplete:!0}},Q=async function(a,t,e){let s=null,r=null;const l=`https://musicbrainz.org/ws/2/release?release-group=${t}&inc=labels&fmt=json`;if(a=="release_groups"||a=="recordings"){let n=await(await fetch(l)).json();if(n=n.releases,n&&n.length>0){for(const i of n)if(e==i.date)return i["label-info"].length>0&&(s=i["label-info"][0].label.name,r=i["label-info"][0].label.id),{name:s,mbid:r}}}return{name:s,mbid:r}},Oe=function(a){return de[a]},V=function(a,t){let e=null;return a=="artists"?e=t.id??null:(a=="release_groups"||a=="recordings")&&(e=t["artist-credit"][0].artist.id??null),e},W=function(a,t){let e=null;return a=="artists"?e=t.name??null:(a=="release_groups"||a=="recordings")&&(e=t["artist-credit"][0].artist.name??null),e},Xe=function(a,t){let e=null;return a=="artists"&&(e=t.area?t.area.name:null),e},ye=function(a,t){let e={mbid:null,release_date:null,artist_name:null,release_group_name:null};return a=="release_groups"?e={mbid:t.id,release_date:t["first-release-date"],artist_name:t["artist-credit"][0].artist.name,release_group_name:t.title}:a=="recordings"&&(e={mbid:t.releases[0]["release-group"].id,release_date:null,artist_name:t["artist-credit"][0].artist.name,release_group_name:t.releases[0]["release-group"].title}),e},C=function(a,t){let e=null;return a=="release_groups"?e=t.id??null:a=="recordings"&&(e=t.releases[0]["release-group"].id??null),e},$=function(a,t){let e=null;return a=="release_groups"?e=t.title??null:a=="recordings"&&(e=t.releases?t.releases[0]["release-group"].title:null),e},ee=function(a,t){let e=null;return a=="recordings"&&(e=t.id??null),e},te=function(a,t){let e=null;return a=="recordings"&&(e=t.title??null),e},ae=function(a,t){let e=null;return a=="recordings"&&(e=t.releations&&t.relations[0].artist.type=="remixer"?t.relations[0].artist.id:null),e},re=function(a,t){let e="";return a=="artists"?e=t["life-span"]?t["life-span"].begin:"":a=="release_groups"&&(e=t["first-release-date"]??""),e};function Ae(a){return a.size=="mega"}const he=async function(a){try{const t=`https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=${be}&artist=${a.artist_name}&album=${a.release_group_name}&format=json`;return(await(await fetch(t)).json()).album.image.find(Ae)["#text"]}catch{return null}},we=async function(a){if(a.release_group_name==null&&a.release_group_mbid==null)throw Error;const t=`https://coverartarchive.org/release-group/${a.release_group_mbid}/front`;try{let e=null;if(t){const n=(await fetch(t,{signal:AbortSignal.timeout(3e3)})).url,i=new XMLHttpRequest;i.open("HEAD",n,!1),i.send(),e=i.status==404?null:n}const s=await he(a),r=new XMLHttpRequest;r.open("HEAD",s,!1),r.send();const l=r.status==404?null:s;if(!e&&!s)throw Error;return{coverArtArchiveUrl:e,lastFmCoverArtUrl:l,wave:P,success:!0}}catch{throw Error}},Ue=function(a,t,e,s){if(e.length<1)return{isDuplicate:!1,duplicateItem:null};const r=t.find(i=>i[s]==a),l=t.find(i=>i.user_added_metadata_id==a),u=!!(r||l);return{isDuplicate:u,duplicateItem:u?r??l:null}},De=function(a,t,e){if(t.length<=1)return!1;const s=a.id;return!!t.find(l=>l[e]==s)},Ie=function(a,t){const e=parseInt(a);return t.length>=e},ze=async function(a,t,e,s,r,l){const{isDuplicate:u}=Ue(a.id,t,e,l),n=De(a,e,l),i=Ie(s,t),m=a.id;if(u)return alert("That item is already in this collection."),{addedItems:t,deletedItems:e,newItemAdded:!1};let g=null;if(n){const o=e.find(A=>A[l]==m);g=o==null?void 0:o.original_id,e=e.filter(A=>A!=o),alert("That item was previously deleted from this collection, but will now be added back in.")}if(i)return alert(`Only ${s} items are allowed in this collection. Please delete an item before you add something new.`),{addedItems:t,deletedItems:e,newItemAdded:!1};const p=C(r,a),b=re(r,a),f=await Q(r,p,b);return t=[...t,{original_id:g??null,item_position:t.length,artist_mbid:V(r,a),artist_name:W(r,a),release_group_mbid:p,release_group_name:$(r,a),recording_mbid:ee(r,a),recording_name:te(r,a),remixer_mbid:ae(r,a)??null,release_date:b,img_url:null,last_fm_img_url:null,label:f.name,notes:null,item_type:Y[r],id:t.length}],{addedItems:t,deletedItems:e,newItemAdded:!0}},Be=async function(a,t,e){const s=C(e,a),r=re(e,a),l=await Q(e,s,r);return t={artist_mbid:V(e,a),artist_name:W(e,a),release_group_mbid:s,release_group_name:$(e,a),recording_mbid:ee(e,a),recording_name:te(e,a),remixer_mbid:ae(e,a),release_date:r,img_url:null,last_fm_img_url:null,label:l.name,notes:null,item_type:Y[e]},{addedItems:t}};var Ne=F("<img>"),xe=F("<img>"),Me=F('<img alt="not found">'),Fe=F('<img alt="loading">'),Le=F('<img alt="not found">');function qe(a,t){fe(t,!0);let e=M(t,"item",3,null),s=M(t,"imgUrl",3,null),r=M(t,"lastFmImgUrl",3,null),l=M(t,"artistName",3,null),u=M(t,"releaseGroupName",3,null);const n=q(()=>({img_url:s()??e().img_url??e().avatar_url??null,last_fm_img_url:r()??e().last_fm_img_url??e().last_fm_avatar_url??null,artist_name:l()??e().artist_name??e().avatar_artist_name??null,artist_mbid:e().artist_mbid??null,release_group_name:u()??e().release_group_name??e().avatar_release_group_name??null,release_group_mbid:e().release_group_mbid??null})),i=q(()=>({artist_name:l()??e().artist_name??e().avatar_artist_name??null,release_group_name:u()??e().release_group_name??e().avatar_release_group_name??null,artist_mbid:e().artist_mbid??null,release_group_mbid:e().release_group_mbid??null}));var m=Z(),g=B(m);{var p=f=>{var o=Ne();I(()=>{w(o,"src",v(n).last_fm_img_url??v(n).img_url),w(o,"alt",t.altText),N(o,1,x(t.imgClass),"svelte-711cl0")}),h(f,o)},b=(f,o)=>{{var A=c=>{var U=Z(),le=B(U);ve(le,()=>we(v(i)),D=>{var d=Fe();w(d,"src",P),I(()=>N(d,1,x(t.imgClass),"svelte-711cl0")),h(D,d)},(D,d)=>{var L=xe();I(()=>{w(L,"src",v(d).coverArtArchiveUrl??v(d).lastFmCoverArtUrl??v(d).wave),w(L,"alt",v(d)?t.altText:"not found"),N(L,1,x(t.imgClass),"svelte-711cl0")}),h(D,L)},D=>{var d=Me();w(d,"src",P),I(()=>N(d,1,x(t.imgClass),"svelte-711cl0")),h(D,d)}),h(c,U)},_=c=>{var U=Le();w(U,"src",P),I(()=>N(U,1,x(t.imgClass),"svelte-711cl0")),h(c,U)};K(f,c=>{!e()||e()&&!v(n).last_fm_img_url&&!v(n).img_url?c(A):c(_,!1)},o)}};K(g,f=>{e()&&(v(n).last_fm_img_url||v(n).img_url)?f(p):f(b,!1)})}h(a,m),_e()}export{qe as C,Ge as P,He as a,W as b,Xe as c,Be as d,C as e,ze as f,we as g,ye as h,re as i,V as j,te as k,ve as l,Oe as m,Je as n,$ as r,P as w};
